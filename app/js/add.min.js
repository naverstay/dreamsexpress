var color_popup;$(function(e){e(".colorPicker").each(function(o){var r=e(this);r.ColorPicker({flat:!0})}),body.delegate(".addColor","click",function(){var o,r=e(this),a=e(r.attr("href"));if(a.length&&(o="#"+a.find(".colorpicker_hex input").val()),isHex(o)){var t=r.nextAll(".uploadPreview").append('<li class="prodColorItem"><div class="prod_preview _rounded" style="background:'+o+';"></div><span class="prod_rm_btn rmProdColor"></span></li>').prev(),l=t.val()+","+o;t.val(l.replace(/^,/,"")),t.validationEngine("validate")}return!1}).delegate(".rmProdColor","click",function(){var o=e(this),r=o.closest(".prodColorItem"),a=r.find(".prod_preview").css("background-color"),t=o.closest(".uploadPreview").prevAll("input");return t.val(t.val().replace(new RegExp(",?"+a,"ig"),"").replace(/^,/,"")),r.remove(),!1}).delegate(".rmProdPreview","click",function(){var o=e(this),r=o.closest(".prodPreviewItem"),a=r.find("img").attr("src"),t=o.closest(".uploadPreview").prevAll("input");return e.ajax({type:"post",url:"/remove",dataType:"json",data:{remove:a},beforeSend:function(e){},success:function(e){console.log(e,e.error),e.remove_done&&(r.remove(),t.val(t.val().replace(new RegExp(",?"+a,"ig"),"").replace(/^,/,"")))},error:function(e,o,r){console.log(e,o,r)},complete:function(e){t.validationEngine("validate")}}),!1}),e(".uploadInput").on("change",function(){for(var o=e(this),r=new FormData,a=0;a<o[0].files.length;a++)r.append("imgs",o[0].files[a]);setTimeout(function(){e.ajax({type:"post",url:"/upload/"+o.attr("data-context"),cache:!1,contentType:!1,processData:!1,dataType:"json",data:r,beforeSend:function(e){},success:function(r){if(console.log(r,r.error),r.upload_done){for(var a="",t=e('input[name="'+o.attr("data-target")+'"]'),l="",n=0;n<r.files.length;n++)l+=","+r.files[n],a+='<li class="prodPreviewItem"><div class="prod_preview"><img src="'+r.files[n]+'"></div><span class="prod_rm_btn rmProdPreview"></span></li>';if(o.attr("multiple"))t.val((t.val()+l).replace(/^,/,"")).next(".uploadPreview").append(a);else{var i=t.val();t.nextAll(".uploadPreview").find(".prod_rm_btn").click(),t.val(i.length?i+","+l.replace(/^,/,""):l.replace(/^,/,"")).nextAll(".uploadPreview").html(a)}t.validationEngine("validate")}},error:function(e,o,r){console.log(e,o,r)},complete:function(e){}})},10)}),e(".addForm").on("submit",function(){var o=e(this),r=!1;if(!o.validationEngine("validate"))return!1;if(!r){var a=o.serialize();e(".preloader").fadeIn(1e3),console.log(o.attr("method"),o.attr("action"),a),e.ajax({type:o.attr("method"),url:o.attr("action"),dataType:"json",data:a,beforeSend:function(e){o.find(".saveBtn").attr("disabled","disabled")},success:function(o){console.log(o,o.error),e(".successText").text("Товар добавлен."),success_popup.dialog("open")},error:function(e,o,r){console.log(e,o,r)},complete:function(r){o.find(".saveBtn").prop("disabled",null),e(".preloader").fadeOut(1e3)}})}return!1})});